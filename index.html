<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–û–õ–ï –ß–£–î–ï–° ‚Äî –Æ–±–∏–ª–µ–π–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è –ï–≤–≥–µ–Ω–∏—è</title>
  <style>
    :root{
      --ink:#f7f9ff; --muted:#b9c6ff;
      --gold:#ffdc73; --gold2:#ffcc33; --gold3:#b98a00; --blue:#0f1d47; --blue2:#0a1535; --card:#0b1f4a;
      --good:#4ee6a3; --bad:#ff7a7a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:url('unnamed.jpg') repeat fixed center/220px #06122b;
    }
    .veil{min-height:100%; backdrop-filter: blur(1px); background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.75));}
    .wrap{max-width:1180px; margin:0 auto; padding:24px}

    /* Head */
    .title{font-size:34px; font-weight:900; letter-spacing:2px; text-transform:uppercase; color:var(--gold);
      text-shadow:0 2px 0 #000, 0 7px 18px rgba(0,0,0,.4)}
    .sub{color:var(--muted); font-size:13px}

    /* Layout */
    .grid{display:grid; grid-template-columns:1.2fr 0.9fr; gap:18px; margin-top:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); border-radius:20px; box-shadow:0 18px 60px rgba(0,0,0,.4)}
    .pad{padding:18px}
    .bar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .gold{color:var(--gold)}
    .btn{appearance:none; border:none; cursor:pointer; font-weight:900; letter-spacing:.3px; color:#1a1400; background:linear-gradient(180deg, var(--gold), var(--gold2)); border-radius:14px; padding:10px 14px; box-shadow:0 4px 0 var(--gold3), 0 10px 26px rgba(0,0,0,.3)}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:linear-gradient(180deg,#142458,#0e1a44); color:var(--ink); border:1px solid rgba(255,255,255,.12)}

    /* Wheel */
    .wheel-wrap{position:relative; display:grid; place-items:center; padding:26px; border-radius:24px; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1)}
    #wheel{width:100%; max-width:740px; aspect-ratio:1; background:#06112a; border-radius:50%; box-shadow:inset 0 0 50px rgba(0,0,0,.7)}
    .pin{position:absolute; top:10px; width:0; height:0; border-left:16px solid transparent; border-right:16px solid transparent; border-bottom:26px solid var(--gold2); filter:drop-shadow(0 3px 8px rgba(0,0,0,.6))}
    .cap{position:absolute; width:150px; height:150px; border-radius:50%; background:radial-gradient(circle at 35% 30%, #fff, #ffe9a3 40%, #ffcf4d 60%, #d2a500 100%); box-shadow: inset 0 0 30px rgba(0,0,0,.35), 0 6px 24px rgba(0,0,0,.5); display:grid; place-items:center}
    .cap .btn{border-radius:50%; padding:18px 18px}

    .panel{min-height:84px; display:flex; align-items:center; justify-content:space-between; gap:10px}
    .panel .rule{font-weight:800}
    .log{margin-top:10px; height:110px; overflow:auto; padding:8px 12px; background:#0c1130; border-radius:12px; border:1px solid rgba(255,255,255,.08)}

    /* Right column */
    .qbox{min-height:210px}
    .q{font-weight:800}
    .word-len{opacity:.8; font-size:13px}
    .answer{display:flex; gap:8px; margin-top:10px}
    .answer input{flex:1; padding:12px 14px; border-radius:12px; border:2px solid transparent; background:#0f1538; color:var(--ink); font-weight:700; letter-spacing:.5px}
    .answer.correct input{border-color:var(--good)}
    .answer.wrong input{border-color:var(--bad)}
    .note{font-size:12px; color:var(--muted)}

    /* Intro modal */
    .intro{position:fixed; inset:0; display:grid; place-items:center; background:rgba(7,10,24,.88); z-index:1000}
    .intro.hide{display:none}
    .ibox{width:min(720px,92vw); background:linear-gradient(180deg, #12265c, #0d1b46); border:1px solid rgba(255,255,255,.12); border-radius:20px; box-shadow:0 28px 90px rgba(0,0,0,.55); padding:18px}
    .ibox h3{margin:0; color:var(--gold); text-shadow:0 1px 0 #000}
    .itype{margin-top:10px; background:#0f1538; border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:12px; min-height:120px; max-height:280px; overflow:auto; font-weight:700; line-height:1.35}
    .icta{display:flex; gap:10px; margin-top:12px}

    /* Result modal */
    .modal{position:fixed; inset:0; background:rgba(5,10,25,.86); display:none; place-items:center; z-index:1500}
    .modal.show{display:grid}
    .modal-card{width:min(720px,92vw); border-radius:20px; padding:22px; color:var(--ink);
      background:linear-gradient(180deg,#12265c,#0d1b46);
      border:1px solid rgba(255,255,255,.12); box-shadow:0 28px 90px rgba(0,0,0,.55); text-align:center}
    .modal-title{margin:0 0 8px; color:var(--gold); font-weight:900}
    .modal-text{font-weight:800; margin:6px 0 14px}
    .bigScore{font-weight:900; font-size:clamp(42px, 9vw, 120px); line-height:1; color:var(--gold);
      text-shadow:0 2px 0 #000,0 10px 26px rgba(0,0,0,.35)}

    /* Glow for selected points */
    .points{font-weight:900; color:var(--gold); text-shadow:0 0 12px rgba(255,220,115,.9)}
  </style>
</head>
<body>
  <!-- Intro -->
  <div id="intro" class="intro">
    <div class="ibox">
      <h3>üéôÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–π</h3>
      <div id="introText" class="itype"></div>
      <div class="icta">
        <button id="introPlay" class="btn">‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
        <button id="introClose" class="btn btn-ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="note">–ó–≤—É–∫ ‚Äî <code>intro.mp3</code>. –¢–µ–∫—Å—Ç –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.</div>
    </div>
  </div>

  <div class="veil">
    <div class="wrap">
      <div class="bar">
        <div>
          <div class="title">–ü–û–õ–ï –ß–£–î–ï–° ‚Äî –º–∏–Ω–∏-—à–æ—É</div>
          <div class="sub">–ö—Ä—É—Ç–∏ –±–∞—Ä–∞–±–∞–Ω, –Ω–∞–±–∏—Ä–∞–π –æ—á–∫–∏ –∏ –æ—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.</div>
        </div>
        <div class="bar">
          <button id="reset" class="btn btn-ghost">–°–±—Ä–æ—Å</button>
        </div>
      </div>

      <!-- Top panel -->
      <div class="card pad panel" id="panel">
        <div class="rule" id="rule">–ü—Ä–∞–≤–∏–ª–∞: –Ω–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∏—Ç—å¬ª, –¥–æ–∂–¥–∏—Å—å –æ—á–∫–æ–≤ –∏ –æ—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å.</div>
        <div>–°—á—ë—Ç: <span id="score" class="points">0</span></div>
      </div>

      <div class="grid">
        <!-- Left: Wheel -->
        <div class="card pad">
          <div class="wheel-wrap">
            <div class="pin"></div>
            <canvas id="wheel"></canvas>
            <div class="cap"><button id="spin" class="btn">üé° –ö—Ä—É—Ç–∏—Ç—å</button></div>
          </div>
          <div class="log" id="log"></div>
        </div>

        <!-- Right: Question / Answer -->
        <div class="card pad qbox">
          <div class="q" id="question">–í–æ–ø—Ä–æ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–ø–∏–Ω–∞.</div>
          <div class="word-len" id="length"></div>
          <div class="answer" id="answerBox">
            <input id="answer" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" />
            <button id="submit" class="btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
          </div>
          <div class="note">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—Å—è <span style="color:var(--good)">–∑–µ–ª—ë–Ω—ã–º</span>, –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî <span style="color:var(--bad)">–∫—Ä–∞—Å–Ω—ã–º</span>.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Result modal -->
  <div id="qModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3 class="modal-title">–¢–≤–æ–∏ –±–∞–ª–ª—ã</h3>
      <div id="qScore" class="modal-text bigScore"></div>
      <div id="qText" class="modal-text"></div>
      <button id="qClose" class="btn">–ü–æ–Ω—è–ª ‚úîÔ∏è</button>
    </div>
  </div>

  <script>
    // ===== Intro (audio + typewriter)
    const introTextFixed = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –ï–≤–≥–µ–Ω–∏–π. –°–µ–≥–æ–¥–Ω—è —É —Ç–µ–±—è –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, –∞ –∑–Ω–∞—á–∏—Ç –≤—Ä–µ–º—è —Å—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É: –∫—Ä—É—Ç–∏ –±–∞—Ä–∞–±–∞–Ω.
–ü—Ä–∞–≤–∏–ª–∞ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã... –º–º –ø–æ–ª—É—á–∞–π —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π –ø—Ä–∏–∑—ã`;
    const introAudio = new Audio('intro.mp3');
    const intro = document.getElementById('intro');
    const introPlay = document.getElementById('introPlay');
    const introClose = document.getElementById('introClose');
    const introTextEl = document.getElementById('introText');

    function typewrite(text, el, speed=24){
      return new Promise(res=>{
        el.textContent=''; let i=0;
        const t=setInterval(()=>{
          el.textContent += text[i++]||'';
          if(i>=text.length){ clearInterval(t); res(); }
        }, speed);
      });
    }

    introPlay.addEventListener('click', async ()=>{
      introPlay.disabled = true;
      try{ await introAudio.play(); }catch(e){}
      await typewrite(introTextFixed, introTextEl);
    });
    introClose.addEventListener('click', ()=>{
      intro.classList.add('hide'); try{ introAudio.pause(); }catch(e){}
    });

    // ===== Spin music (idle 30%, spin 100%)
    const spinSong = new Audio('song.mp3');
    spinSong.loop = true;
    spinSong.preload = 'auto';
    spinSong.volume = 0.3; // 30% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    // ===== Wheel logic
    const points = [100,200,300,400,500,600,700,800,900,1000];
    const wheel  = document.getElementById('wheel');
    const ctx    = wheel.getContext('2d');
    let angle=0, spinning=false, firstSpin=true;

    function drawWheel(a=0){
      const W = wheel.width  = wheel.clientWidth  * devicePixelRatio;
      const H = wheel.height = wheel.clientHeight * devicePixelRatio;
      const cx=W/2, cy=H/2; const R=Math.min(W,H)/2 - 12*devicePixelRatio;
      const n = points.length; const arc = 2*Math.PI/n;
      ctx.clearRect(0,0,W,H); ctx.save(); ctx.translate(cx,cy); ctx.rotate(a);
      for(let i=0;i<n;i++){
        ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,R,i*arc,(i+1)*arc);
        ctx.fillStyle = (i%2? '#103079':'#142d63'); ctx.fill();
        ctx.strokeStyle = '#0a1e4f'; ctx.lineWidth = 3*devicePixelRatio; ctx.stroke();
        // number at rim
        ctx.save(); ctx.rotate(i*arc + arc/2); ctx.fillStyle = '#ffdc73';
        ctx.font = `${Math.max(18*devicePixelRatio,R*0.085)}px system-ui`;
        ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.translate(R*0.75,0); ctx.rotate(Math.PI/2);
        ctx.fillText(points[i].toString(),0,0);
        ctx.restore();
      }
      // bulbs
      const bulbs = 72;
      for(let i=0;i<bulbs;i++){
        const ang = a + (i/bulbs)*Math.PI*2;
        const bx = Math.cos(ang)*(R+10*devicePixelRatio);
        const by = Math.sin(ang)*(R+10*devicePixelRatio);
        ctx.beginPath(); ctx.arc(bx,by,4*devicePixelRatio,0,Math.PI*2);
        const on = (Math.floor(Date.now()/120)%2===i%2);
        ctx.fillStyle = on? 'rgba(255,240,150,.95)':'rgba(255,210,77,.85)';
        ctx.fill(); ctx.strokeStyle='rgba(0,0,0,.45)'; ctx.stroke();
      }
      ctx.restore();
    }

    function spin(){
      if(spinning) return;
      spinning = true;

      // –ú—É–∑—ã–∫–∞ ‚Äî 100% –Ω–∞ –≤—Ä–µ–º—è —Å–ø–∏–Ω–∞
      try{ spinSong.volume = 1.0; if (spinSong.paused) spinSong.play(); }catch(e){}

      // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1-–π —Å–ø–∏–Ω 20—Å, –æ—Å—Ç–∞–ª—å–Ω—ã–µ 10—Å; —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
      const DURATION  = firstSpin ? 20000 : 10000;   // –º—Å
      const TURNS     = firstSpin ? 8 : 5;           // –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ –¥–æ —Å–µ–∫—Ç–æ—Ä–∞
      firstSpin = false;

      const startAngle = angle;
      const n = points.length; const arc = 2*Math.PI/n;
      const targetIndex = Math.floor(Math.random()*n);
      const targetAngle = (2*Math.PI - (targetIndex + 0.5)*arc) % (2*Math.PI); // —Ü–µ–Ω—Ç—Ä —Å–µ–∫—Ç–æ—Ä–∞ –ø–æ–¥ –ø–∏–Ω–æ–º
      const endAngle    = targetAngle + TURNS*2*Math.PI;

      // –ø–ª–∞–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ü—É
      const easeOutCubic = t => 1 - Math.pow(1 - t, 3);
      const t0 = performance.now();

      function step(ts){
        const t = Math.min(1, (ts - t0) / DURATION);
        const eased = easeOutCubic(t);
        angle = startAngle + (endAngle - startAngle) * eased;
        drawWheel(angle);
        if(t < 1) requestAnimationFrame(step); else { spinning=false; finalize(targetIndex); }
      }
      requestAnimationFrame(step);
    }

    function finalize(idx){
      // –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî —Ç—Ä–µ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è –∏–≥—Ä–∞—Ç—å –Ω–∞ 30%
      try{ spinSong.volume = 0.3; if (spinSong.paused) spinSong.play(); }catch(e){}
      const p = points[idx];

      log(`üéØ –í—ã–ø–∞–ª–æ: <b>${p}</b> –æ—á–∫–æ–≤`);
      document.getElementById('rule').innerHTML = `–¢–≤–æ–∏ –æ—á–∫–∏: <span class="points">${p}</span>. –û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å!`;

      // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã —Å —Ç–µ–∫—É—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º
      const r = rounds[round];
      setTimeout(()=>{
        document.getElementById('qScore').textContent = `${p}`;
        document.getElementById('qText').textContent  = `–¢–≤–æ–π –≤–æ–ø—Ä–æ—Å: "${r ? r.q : '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! üéâ'}"`;
        qModal.classList.add('show');
        qModal.setAttribute('aria-hidden','false');
      }, 2000);

      // –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
      showQuestion();
    }

    function log(html){
      const box=document.getElementById('log');
      const d=document.createElement('div');
      d.innerHTML = `<span class="note">${new Date().toLocaleTimeString()}</span> ${html}`;
      box.prepend(d);
    }

    document.getElementById('spin').addEventListener('click', spin);
    window.addEventListener('resize', ()=> drawWheel(angle));
    drawWheel(angle);

    // ===== Rounds (–≤–ø–∏—à–∏ —Å—é–¥–∞ —Å–≤–æ–∏ 4 –≤–æ–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç—ã –≤ –í–ï–†–•–ù–ï–ú –†–ï–ì–ò–°–¢–†–ï)
    const rounds = [
      { q: '–ß—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å?', a: '–ë–£–ö–í–ê' },
      { q: '–õ—é–±–∏–º–∞—è –∏–≥—Ä–∞ —É –Ø–∫—É–±–æ–≤–∏—á–∞?', a: '–ü–û–õ–ï–ß–£–î–ï–°' },
      { q: '–ß—Ç–æ –∫—Ä—É—Ç—è—Ç –≤ –Ω–∞—à–µ–π –∏–≥—Ä–µ?', a: '–ë–ê–†–ê–ë–ê–ù' },
      { q: '–ß–µ–º –æ—Ç–º–µ—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è?', a: '–ü–†–ê–ó–î–ù–ò–ö' }
    ];
    let round = 0; let score = 0;

    function showQuestion(){
      const r = rounds[round];
      document.getElementById('question').textContent = r ? `–í–æ–ø—Ä–æ—Å: ${r.q}` : '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! üéâ';
      document.getElementById('length').textContent  = r ? `–°–ª–æ–≤–æ –∏–∑ ${r.a.length} –±—É–∫–≤` : '';
      const input = document.getElementById('answer'); input.value=''; input.focus();
      document.getElementById('answerBox').classList.remove('correct','wrong');
    }

    function checkAnswer(){
      const r = rounds[round]; if(!r) return;
      const got = document.getElementById('answer').value.trim().toUpperCase().replace(/–Å/g,'–ï');
      const need= r.a.toUpperCase().replace(/–Å/g,'–ï');
      const box = document.getElementById('answerBox');

      if(got === need){
        box.classList.remove('wrong'); box.classList.add('correct');
        const p = parseInt(document.getElementById('qScore').textContent || '0', 10);
        score += isNaN(p) ? 0 : p; // –¥–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏–Ω–∞
        document.getElementById('score').textContent = score;
        log('‚úÖ –°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ!');
        round++;
        setTimeout(()=>{
          document.getElementById('rule').textContent = '–°–Ω–æ–≤–∞ –∫—Ä—É—Ç–∏ –±–∞—Ä–∞–±–∞–Ω!';
          document.getElementById('question').textContent = '–í–æ–ø—Ä–æ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–ø–∏–Ω–∞.';
          document.getElementById('length').textContent = '';
        }, 600);
      } else {
        box.classList.remove('correct'); box.classList.add('wrong');
        log('‚ùå –ù–µ–≤–µ—Ä–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.');
      }
    }

    document.getElementById('submit').addEventListener('click', checkAnswer);
    document.getElementById('answer').addEventListener('keydown', e=>{ if(e.key==='Enter') checkAnswer(); });

    // Result modal controls
    const qModal = document.getElementById('qModal');
    document.getElementById('qClose').addEventListener('click',()=>{
      qModal.classList.remove('show');
      qModal.setAttribute('aria-hidden','true');
      document.getElementById('answer').focus();
    });

    document.getElementById('reset').addEventListener('click', ()=>{
      try{ spinSong.pause(); }catch(e){}
      spinSong.currentTime=0; spinSong.volume=0.3;
      score=0; round=0; angle=0;
      document.getElementById('score').textContent='0';
      document.getElementById('rule').textContent='–ü—Ä–∞–≤–∏–ª–∞: –Ω–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∏—Ç—å¬ª, –¥–æ–∂–¥–∏—Å—å –æ—á–∫–æ–≤ –∏ –æ—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å.';
      document.getElementById('question').textContent='–í–æ–ø—Ä–æ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–ø–∏–Ω–∞.';
      document.getElementById('length').textContent='';
      qModal.classList.remove('show'); qModal.setAttribute('aria-hidden','true');
      drawWheel(0); document.getElementById('log').innerHTML='';
    });
  </script>
</body>
</html>
