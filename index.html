<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–û–õ–ï –ß–£–î–ï–° ‚Äî –Æ–±–∏–ª–µ–π–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è –ï–≤–≥–µ–Ω–∏—è</title>
  <style>
    body {
      background: radial-gradient(circle, #002b5b, #000);
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      text-align: center;
    }
    /* Modal overlay style */
    .modal {
      display: none;
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      /* center content */
      display: flex; justify-content: center; align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #1c5172;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 10px #000;
    }
    .modal-content h2 {
      margin: 0 0 10px;
    }
    .modal-content button {
      margin: 10px 5px 0;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #444;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
    }
    .modal-content button:hover {
      background: #555;
    }
    /* Super-game modal text slightly larger */
    #superModal .modal-content {
      font-size: 1.2em;
    }
    /* Main game area */
    #gameArea {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    #questionText {
      font-size: 1.2em;
      margin: 10px 0;
    }
    #puzzleWord {
      font-size: 2em;
      font-family: monospace;
      letter-spacing: 0.2em;
      white-space: pre;
      margin: 10px 0 20px;
    }
    #hintText {
      font-size: 0.9em;
      font-style: italic;
      color: #ccc;
      margin-bottom: 20px;
    }
    #scoreBoard {
      text-align: right;
      margin: 10px;
      font-weight: bold;
    }
    #scoreBoard span {
      color: #ffd700;
      font-size: 1.2em;
    }
    /* Wheel and pointer */
    #wheelContainer {
      position: relative;
      display: inline-block;
      margin: 20px 0;
    }
    #wheel {
      width: 60vmin;
      max-width: 100%;
      display: block;
    }
    #pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 20px solid red;
      /* ensure pointer on top of wheel */
      z-index: 1;
    }
    /* Input and button for guessing */
    #guessInput {
      font-size: 1em;
      padding: 5px;
      width: 200px;
      max-width: 80%;
      text-align: center;
    }
    #guessBtn {
      padding: 6px 12px;
      margin-left: 5px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background: #444;
      color: #fff;
      cursor: pointer;
    }
    #guessBtn:hover {
      background: #555;
    }
    /* Flash effect for wrong guess */
    #guessInput.wrong {
      background: #ff4444;
      color: #fff;
    }
    /* Puzzle solved highlight */
    #puzzleWord.solved {
      color: #4ef442;
    }
    /* Prize selection section */
    #prizeSection {
      display: none;
      padding: 20px;
      text-align: center;
    }
    #prizeSection h2 {
      margin-top: 0;
    }
    #prizeSection table {
      width: 100%;
      max-width: 600px;
      margin: 10px auto;
      border-collapse: collapse;
      color: #fff;
    }
    #prizeSection th, #prizeSection td {
      border: 1px solid #fff;
      padding: 8px;
    }
    #prizeSection th {
      background: #1c5172;
    }
    #prizeSection td:nth-child(2), #prizeSection th:nth-child(2) {
      text-align: right;
    }
    #prizeSection td:nth-child(3), #prizeSection th:nth-child(3) {
      text-align: center;
    }
    #prizeSection button {
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #444;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
    }
    #prizeSection button:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <!-- Intro Modal -->
  <div id="introModal" class="modal" style="display: flex;">
    <div class="modal-content">
      <h2>üì¢ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–π</h2>
      <p id="introText"></p>
      <button id="playIntroBtn">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
      <button id="skipIntroBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
  <!-- Super Game Modal -->
  <div id="superModal" class="modal">
    <div class="modal-content">
      <p id="superPrompt"><strong>–°—É–ø–µ—Ä-–∏–≥—Ä–∞!</strong> –û—á–∫–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —É–¥–≤–∞–∏–≤–∞—é—Ç—Å—è. –û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: <em>–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –±–µ–∑ –≤–∏–∑—ã. –ß—Ç–æ —ç—Ç–æ?</em></p>
      <input type="text" id="superInput" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
      <button id="superSubmitBtn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
      <p id="superError" style="color: #ff7777; display: none;"></p>
    </div>
  </div>
  <!-- Final Message Modal -->
  <div id="finalModal" class="modal">
    <div class="modal-content" id="finalMessageContent">
      <!-- Final message will be set via script -->
      <button id="finalCloseBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- Main Game Area -->
  <div id="gameArea">
    <div id="scoreBoard">–û—á–∫–∏: <span id="score">0</span></div>
    <p id="questionText"></p>
    <p id="puzzleWord"></p>
    <p id="hintText">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º, –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –∫—Ä–∞—Å–Ω—ã–º.</p>
    <div id="wheelContainer">
      <img id="wheel" src="wheel.png" alt="Wheel">
      <div id="pointer"></div>
    </div>
    <div>
      <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å –±–∞—Ä–∞–±–∞–Ω</button>
    </div>
    <div style="margin-top: 15px;">
      <input type="text" id="guessInput" placeholder="–í–∞—à–∞ –±—É–∫–≤–∞ –∏–ª–∏ —Å–ª–æ–≤–æ">
      <button id="guessBtn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
    </div>
  </div>

  <!-- Prize Selection Section -->
  <div id="prizeSection">
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏</h2>
    <p>–í–∞—à –±—é–¥–∂–µ—Ç: <span id="budgetTotal">0</span> –æ—á–∫–æ–≤.</p>
    <table>
      <thead>
        <tr><th>–ü–æ–¥–∞—Ä–æ–∫</th><th>–¶–µ–Ω–∞, –æ—á–∫–∏</th><th>–í—ã–±—Ä–∞—Ç—å</th></tr>
      </thead>
      <tbody id="prizesList">
        <tr><td>–ì–æ—Ç–æ–≤–Ω—è (–Ω–∞–±–æ—Ä —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –∫—É—Ö–Ω–∏)</td><td>5000</td><td><input type="checkbox" class="prizeCheck" data-cost="5000"></td></tr>
        <tr><td>–•–æ—á—É –≤—Å—ë –∑–Ω–∞—Ç—å (–Ω–æ—É—Ç–±—É–∫)</td><td>4000</td><td><input type="checkbox" class="prizeCheck" data-cost="4000"></td></tr>
        <tr><td>–ë–∞–π-–±–∞–π (—Å–ø–∞–ª—å–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä)</td><td>3000</td><td><input type="checkbox" class="prizeCheck" data-cost="3000"></td></tr>
        <tr><td>–ë–ª–∏–∑–∫–∏–π –¥—Ä—É–≥ (—Å–º–∞—Ä—Ç-—Ç–µ–ª–µ–≤–∏–∑–æ—Ä)</td><td>2000</td><td><input type="checkbox" class="prizeCheck" data-cost="2000"></td></tr>
        <tr><td>–°–ª–æ–≤–∞—Ä—å (—ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è)</td><td>1000</td><td><input type="checkbox" class="prizeCheck" data-cost="1000"></td></tr>
        <tr><td>–°—É–≤–µ–Ω–∏—Ä (—Ñ–∏—Ä–º–µ–Ω–Ω–∞—è –∫—Ä—É–∂–∫–∞)</td><td>500</td><td><input type="checkbox" class="prizeCheck" data-cost="500"></td></tr>
      </tbody>
    </table>
    <p>–í—ã–±—Ä–∞–Ω–æ: <span id="selectedSum">0</span> –æ—á–∫–æ–≤. –û—Å—Ç–∞–ª–æ—Å—å: <span id="remainingSum">0</span> –æ—á–∫–æ–≤.</p>
    <button id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</button>
  </div>

  <!-- Video container for super-game -->
  <div id="videoContainer" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 2000; justify-content: center; align-items: center;">
    <video id="superVideo" src="dreamina.mp4" style="width:100%; height:100%; object-fit: cover;" ></video>
    <button id="skipVideoBtn" style="position: absolute; top: 10px; right: 10px; padding: 8px 12px; border: none; border-radius: 4px; background: #444; color: #fff; font-size: 1em; cursor: pointer;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ</button>
  </div>

  <script>
    // *** Initializing global variables and game data ***
    let puzzles = [
      { question: "–ë–µ–∑ –Ω–µ–≥–æ –Ω–µ –æ–±—Ö–æ–¥–∏—Ç—Å—è –Ω–∏ –æ–¥–∏–Ω –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è.", answer: "–¢–û–†–¢" },
      { question: "–ü—Ä–∞–∑–¥–Ω–∏–∫ –≤ —á–µ—Å—Ç—å –∫—Ä—É–≥–ª–æ–π –¥–∞—Ç—ã.", answer: "–Æ–ë–ò–õ–ï–ô" },
      { question: "–õ–∞—Å–∫–æ–≤–æ–µ –ø—Ä–æ–∑–≤–∏—â–µ –æ—á–µ–Ω—å –ø–æ–¥–≤–∏–∂–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.", answer: "–®–£–°–¢–†–ò–ö" }
    ];
    let currentPuzzleIndex = 0;
    let score = 0;
    let usedLetters = new Set();
    let awaitingLetter = false;
    let isSpinning = false;
    let isSuperSpin = false;
    let lastIndex = 0; // last wheel sector index at pointer
    const sectorsCount = 12;
    const anglePerSector = 360 / sectorsCount;
    // Wheel sector values (points or special sectors)
    const wheelValues = [100, 200, 300, 0, 500, 1000, 400, 900, 0, 600, 150, 800];

    // Audio elements
    const introAudio = new Audio("intro.mp3");
    const bgAudio = new Audio("song.mp3");
    bgAudio.loop = true;
    const wrongSound = new Audio("pole_letter_wrong.mp3");
    const solveSound = new Audio("zrejdbxx.mp3");

    // DOM element references
    const introModal = document.getElementById("introModal");
    const introTextElem = document.getElementById("introText");
    const playIntroBtn = document.getElementById("playIntroBtn");
    const skipIntroBtn = document.getElementById("skipIntroBtn");
    const superModal = document.getElementById("superModal");
    const superInput = document.getElementById("superInput");
    const superSubmitBtn = document.getElementById("superSubmitBtn");
    const superErrorElem = document.getElementById("superError");
    const finalModal = document.getElementById("finalModal");
    const finalMessageContent = document.getElementById("finalMessageContent");
    const finalCloseBtn = document.getElementById("finalCloseBtn");
    const questionTextElem = document.getElementById("questionText");
    const puzzleWordElem = document.getElementById("puzzleWord");
    const scoreElem = document.getElementById("score");
    const spinBtn = document.getElementById("spinBtn");
    const guessInput = document.getElementById("guessInput");
    const guessBtn = document.getElementById("guessBtn");
    const prizeSection = document.getElementById("prizeSection");
    const budgetTotalElem = document.getElementById("budgetTotal");
    const selectedSumElem = document.getElementById("selectedSum");
    const remainingSumElem = document.getElementById("remainingSum");
    const confirmBtn = document.getElementById("confirmBtn");
    const prizeChecks = document.querySelectorAll(".prizeCheck");
    const videoContainer = document.getElementById("videoContainer");
    const superVideo = document.getElementById("superVideo");
    const skipVideoBtn = document.getElementById("skipVideoBtn");
    const wheel = document.getElementById("wheel");

    // Typewriter effect for intro text
    let typingInterval;
    function typeIntroText(text) {
      introTextElem.textContent = "";
      let index = 0;
      typingInterval = setInterval(() => {
        if (index < text.length) {
          introTextElem.textContent += text.charAt(index);
          index++;
        } else {
          clearInterval(typingInterval);
        }
      }, 50);
    }

    // *** Intro modal event handlers ***
    playIntroBtn.addEventListener("click", () => {
      // Start intro audio and typing effect
      playIntroBtn.disabled = true;
      introAudio.play();
      typeIntroText("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –ï–≤–≥–µ–Ω–∏–π. –°–µ–≥–æ–¥–Ω—è —É —Ç–µ–±—è –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, –∞ –∑–Ω–∞—á–∏—Ç, –≤—Ä–µ–º—è —Å—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É ‚Äî –∫—Ä—É—Ç–∏ –±–∞—Ä–∞–±–∞–Ω! –ü—Ä–∞–≤–∏–ª–∞ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã: –Ω–∞–∑—ã–≤–∞–π –±—É–∫–≤—ã, –æ—Ç–≥–∞–¥—ã–≤–∞–π —Å–ª–æ–≤–∞, –Ω–∞–±–∏—Ä–∞–π –æ—á–∫–∏... –ú-–º-–º, –ø–æ–ª—É—á–∞–π —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π –ø—Ä–∏–∑—ã!");
    });
    skipIntroBtn.addEventListener("click", () => {
      // Stop intro audio and typing, proceed to game
      introAudio.pause();
      introAudio.currentTime = 0;
      clearInterval(typingInterval);
      introModal.style.display = "none";
      startGame();
    });
    // When intro audio ends, enable closing (could auto-close, but we'll let user click –ó–∞–∫—Ä—ã—Ç—å)
    introAudio.addEventListener("ended", () => {
      playIntroBtn.disabled = false;
    });

    // *** Main game functions ***
    function startGame() {
      // Start background music
      bgAudio.play();
      // Load first puzzle
      currentPuzzleIndex = 0;
      score = 0;
      scoreElem.textContent = score;
      loadPuzzle(currentPuzzleIndex);
    }

    function loadPuzzle(index) {
      usedLetters.clear();
      awaitingLetter = false;
      // Enable input and spin for new puzzle
      guessInput.disabled = false;
      guessBtn.disabled = false;
      spinBtn.disabled = false;
      // Display question and reset puzzle word display
      questionTextElem.textContent = puzzles[index].question;
      // Prepare masked word (underscores for each letter, preserve spaces)
      const answer = puzzles[index].answer.toUpperCase();
      let masked = "";
      for (let ch of answer) {
        if (ch === " ") {
          // Use double space for word gap
          masked += "  ";
        } else {
          masked += "_";
        }
      }
      puzzleWordElem.textContent = masked;
      puzzleWordElem.classList.remove("solved");
      // Focus spin button or input? We'll not focus here.
    }

    // Check puzzle solved status
    function isPuzzleSolved() {
      return !puzzleWordElem.textContent.includes("_");
    }

    // *** Wheel spinning function ***
    function spinWheel() {
      // Compute a random new sector index to land on
      const newIndex = Math.floor(Math.random() * sectorsCount);
      // Prepare wheel for spin: set current rotation to lastIndex position
      const currentAngle = lastIndex * anglePerSector;
      wheel.style.transition = "none";
      wheel.style.transform = `rotate(${currentAngle}deg)`;
      // Force reflow
      wheel.offsetWidth; 
      // Calculate target rotation
      let diffIndex = (newIndex - lastIndex + sectorsCount) % sectorsCount;
      const targetAngle = currentAngle + 360 * 7 + diffIndex * anglePerSector;
      // Animate rotation
      wheel.style.transition = "transform 10s linear";
      wheel.style.transform = `rotate(${targetAngle}deg)`;
      // Update lastIndex to newIndex for next spin reference
      lastIndex = newIndex;
      return newIndex;
    }

    // *** Event handlers for main game ***
    spinBtn.addEventListener("click", () => {
      if (isSpinning) return;
      if (awaitingLetter) {
        alert("–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∑–æ–≤–∏—Ç–µ –±—É–∫–≤—É –∏–ª–∏ —Å–ª–æ–≤–æ!");
        return;
      }
      // Start wheel spinning
      isSpinning = true;
      spinBtn.disabled = true;
      guessInput.disabled = true;
      guessBtn.disabled = true;
      const spinResultIndex = spinWheel();
      // After spin animation, handle enabling guess or super game
    });

    // Listen for wheel spin animation end
    wheel.addEventListener("transitionend", () => {
      isSpinning = false;
      if (isSuperSpin) {
        // Super-game spin ended, show super question modal
        superModal.style.display = "flex";
        // Pause background music for video soon
        bgAudio.pause();
        // Reset flag
        isSuperSpin = false;
      } else {
        // Normal spin ended, enable guessing a letter or solving
        awaitingLetter = true;
        guessInput.disabled = false;
        guessBtn.disabled = false;
        guessInput.focus();
      }
    });

    // Guess (letter or word) submission
    function handleGuessSubmission() {
      const guess = guessInput.value.trim().toUpperCase();
      if (!guess) return;
      // Determine if letter or word guess
      if (guess.length === 1) {
        // Letter guess
        if (!awaitingLetter) {
          alert("–°–ø–µ—Ä–≤–∞ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –±–∞—Ä–∞–±–∞–Ω!");
          return;
        }
        const letter = guess;
        guessInput.value = "";
        if (usedLetters.has(letter)) {
          // Letter was already tried
          alert("–≠—Ç—É –±—É–∫–≤—É —É–∂–µ –Ω–∞–∑—ã–≤–∞–ª–∏.");
          return;
        }
        usedLetters.add(letter);
        let found = false;
        const answer = puzzles[currentPuzzleIndex].answer.toUpperCase();
        // Reveal the letter if present
        let newMasked = "";
        for (let i = 0; i < answer.length; i++) {
          const ansChar = answer.charAt(i);
          const maskChar = puzzleWordElem.textContent.charAt(newMasked.length); // current displayed char (taking into account double spaces)
          if (ansChar === " ") {
            // If answer has space, our displayed mask uses double space, just copy it
            newMasked += "  ";
            // Skip the extra space in display text
            i--; // decrement i to counter increment, because answer length counts one space while display had two
            // Actually better to handle via approach of storing mask differently, but let's assume one space. (Simplified handling)
          } else if (ansChar === letter) {
            newMasked += letter;
            found = true;
          } else {
            // if maskChar is already revealed letter (not underscore), keep it
            if (maskChar !== "_") {
              newMasked += maskChar;
            } else {
              newMasked += "_";
            }
          }
        }
        // Update puzzle display
        puzzleWordElem.textContent = newMasked;
        if (found) {
          // Correct letter
          // Add score: spin result value * count of this letter
          const count = (answer.split(letter).length - 1);
          const spinValue = wheelValues[lastIndex];
          score += spinValue * count;
          scoreElem.textContent = score;
          // Check if puzzle solved
          if (isPuzzleSolved()) {
            // Puzzle solved by revealing the last letter
            puzzleWordElem.classList.add("solved");
            solveSound.play();
            guessInput.disabled = true;
            guessBtn.disabled = true;
            // Move to next puzzle or super game after a short delay
            setTimeout(() => {
              if (currentPuzzleIndex === puzzles.length - 1) {
                // Last puzzle solved -> proceed to super game
                startSuperGame();
              } else {
                currentPuzzleIndex++;
                loadPuzzle(currentPuzzleIndex);
              }
            }, 2000);
          } else {
            // Puzzle not solved yet, allow next spin or the player can also guess the word
            // We keep guess input enabled (they might solve now).
            // Enable spin for next letter
            awaitingLetter = false;
            spinBtn.disabled = false;
          }
        } else {
          // Wrong letter
          wrongSound.play();
          // Flash red for wrong guess
          guessInput.classList.add("wrong");
          setTimeout(() => {
            guessInput.classList.remove("wrong");
          }, 500);
          // No letters revealed, end of turn (single player: just spin again)
          awaitingLetter = false;
          spinBtn.disabled = false;
        }
      } else {
        // Word guess
        const guessWord = guess;
        guessInput.value = "";
        if (guessWord === puzzles[currentPuzzleIndex].answer.toUpperCase()) {
          // Correct word guess
          // Reveal the entire word
          puzzleWordElem.textContent = puzzles[currentPuzzleIndex].answer.toUpperCase().split("").map(ch => ch === " " ? " " : ch).join("");
          puzzleWordElem.classList.add("solved");
          solveSound.play();
          guessInput.disabled = true;
          guessBtn.disabled = true;
          // Update score (no additional points for solving, just keep current score)
          // Proceed to next stage
          setTimeout(() => {
            if (currentPuzzleIndex === puzzles.length - 1) {
              // Solved last puzzle -> super game
              startSuperGame();
            } else {
              currentPuzzleIndex++;
              loadPuzzle(currentPuzzleIndex);
            }
          }, 2000);
        } else {
          // Wrong word guess
          wrongSound.play();
          // Highlight input red briefly
          guessInput.classList.add("wrong");
          setTimeout(() => {
            guessInput.classList.remove("wrong");
          }, 500);
          // Show hint (already displayed at bottom)
          // If a spin was awaiting a letter, we consider this wrong solve attempt as using that turn
          if (awaitingLetter) {
            awaitingLetter = false;
            spinBtn.disabled = false;
          }
          // If no spin was active (they guessed without spinning), they can continue guessing or spin; no change needed.
        }
      }
    }

    guessBtn.addEventListener("click", handleGuessSubmission);
    // Allow pressing Enter to submit guess
    guessInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleGuessSubmission();
      }
    });

    // *** Super game initiation after last puzzle ***
    function startSuperGame() {
      // Allow one more spin before super question
      questionTextElem.innerHTML = "<strong>–°—É–ø–µ—Ä-–∏–≥—Ä–∞!</strong> –ö—Ä—É—Ç–∏—Ç–µ –±–∞—Ä–∞–±–∞–Ω –µ—â—ë —Ä–∞–∑.";
      puzzleWordElem.textContent = "";
      // Disable guess input during this spin
      guessInput.disabled = true;
      guessBtn.disabled = true;
      // Mark next spin as super spin
      isSuperSpin = true;
      // Enable spin button for the final spin
      spinBtn.disabled = false;
    }

    // *** Super game answer submission ***
    superSubmitBtn.addEventListener("click", () => {
      const answer = superInput.value.trim().toUpperCase();
      if (!answer) return;
      if (answer === "–ë–£–õ–¨–ë–ê") {
        // Correct super answer
        superErrorElem.style.display = "none";
        superModal.style.display = "none";
        // Double the points if no previous mistake
        if (!superMistakeMade) {
          score = score * 2;
          scoreElem.textContent = score;
        }
        // Play the celebratory video
        videoContainer.style.display = "flex";
        superVideo.play();
      } else {
        // Wrong super answer
        wrongSound.play();
        superMistakeMade = true;
        superErrorElem.textContent = "–≠—Ö—Ö, –≤—ã —Å–æ–≤–µ—Ä—à–∏–ª–∏ –æ—à–∏–±–∫—É. –£–¥–≤–æ–µ–Ω–∏–µ –æ—á–∫–æ–≤ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
        superErrorElem.style.display = "block";
        superInput.value = "";
        superInput.focus();
      }
    });
    // Track if a mistake was made in super game
    let superMistakeMade = false;
    // Also allow Enter key for super answer
    superInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        superSubmitBtn.click();
      }
    });

    // *** Super game video events ***
    superVideo.addEventListener("ended", () => {
      // Video finished, proceed to prize selection
      videoContainer.style.display = "none";
      openPrizeSelection();
    });
    skipVideoBtn.addEventListener("click", () => {
      // Skip video, stop and proceed
      superVideo.pause();
      videoContainer.style.display = "none";
      openPrizeSelection();
    });

    // *** Prize selection logic ***
    function openPrizeSelection() {
      // Set budget and display prize section
      budgetTotalElem.textContent = score;
      selectedSumElem.textContent = 0;
      remainingSumElem.textContent = score;
      prizeSection.style.display = "block";
    }

    // Handle selecting prizes
    prizeChecks.forEach(cb => {
      cb.addEventListener("change", (e) => {
        let total = 0;
        prizeChecks.forEach(item => {
          if (item.checked) {
            total += Number(item.dataset.cost);
          }
        });
        if (total > score) {
          // Over budget, undo selection
          e.target.checked = false;
          total -= Number(e.target.dataset.cost);
          alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞!");
        }
        // Update sums
        selectedSumElem.textContent = total;
        remainingSumElem.textContent = score - total;
      });
    });

    confirmBtn.addEventListener("click", () => {
      // Gather selected prizes
      let selectedItems = [];
      prizeChecks.forEach(item => {
        if (item.checked) {
          const itemName = item.parentElement.parentElement.querySelector("td:first-child").textContent;
          selectedItems.push(itemName);
        }
      });
      // Prepare final message
      let finalMsg = "<h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –ï–≤–≥–µ–Ω–∏–π!</h2>";
      finalMsg += "<p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ " + score + " –æ—á–∫–æ–≤";
      if (selectedItems.length > 0) {
        finalMsg += " –∏ –≤—ã–±—Ä–∞–ª–∏ –ø—Ä–∏–∑—ã: " + selectedItems.join(", ") + ".";
      } else {
        finalMsg += ", –Ω–æ –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞.";
      }
      finalMsg += "</p><p>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è!</p>";
      finalMessageContent.innerHTML = finalMsg;
      // Show final modal
      prizeSection.style.display = "none";
      finalModal.style.display = "flex";
    });

    finalCloseBtn.addEventListener("click", () => {
      // Close final message and reload game (restart)
      finalModal.style.display = "none";
      location.reload();
    });
  </script>
</body>
</html>






















